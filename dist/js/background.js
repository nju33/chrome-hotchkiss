(function(){var config,f;config={STORAGE_NAMES:["page"],CONTEXTMENU_TEXT:"Hotchkiss で留める",TAB_QUERY:{active:!0,currentWindow:!0},BADGE_ACT_COLOR:"#ff6d78",BADGE_PAS_COLOR:"#bcb0b1"},f={getNowTabs:function(callback){return chrome.tabs.query(config.TAB_QUERY,callback)},getPages:function(callback){return chrome.storage.local.get(config.STORAGE_NAMES,callback)},setStorage:function(save,callback){return chrome.storage.local.set(save,callback)},setBadge:function(pageSize){return function(ba){return ba.setBadgeText({text:""+pageSize}),ba.setBadgeBackgroundColor(0===pageSize?{color:config.BADGE_PAS_COLOR}:{color:config.BADGE_ACT_COLOR})}(chrome.browserAction)},useHotchkiss:function(info,tab){var nowPage;return nowPage={faviconUrl:tab.favIconUrl,title:tab.title,url:tab.url,domain:tab.url.match(/\/\/([^\/]+)/)[1]},f.getPages(function(response){var newPage;return newPage=function(o){return o=o||[],o=o.matchUrlRemove(tab.url),o.unshift(nowPage),f.setBadge(o.length),{page:o}}(response.page),f.setStorage(newPage,function(){})})}},Array.prototype.matchUrlRemove=function(tabUrl){return this.filter(function(page){return tabUrl!==page.url?!0:void 0})},function(){var initBadge;return initBadge=null,f.getPages(function(response){return initBadge=null!=response.page&&response.page.length>0?response.page.length:0}),setTimeout(function(){return f.setBadge(initBadge)},1e3)}(),chrome.contextMenus.create({title:config.CONTEXTMENU_TEXT,onclick:f.useHotchkiss}),chrome.commands.onCommand.addListener(function(command){switch(command){case"go-to-next":return f.getNowTabs(function(tabs){var nowUrl;return nowUrl=tabs[0].url,f.getPages(function(respons){return function(o){var isLast,next,pageSize,removalIdxs,urlIdx,urls;return pageSize=o.length,pageSize>0?(urls=o.map(function(page){return page.url}),urlIdx=urls.indexOf(nowUrl),isLast=pageSize===urlIdx+1,removalIdxs=[0],next=function(){return urlIdx>-1?(isLast?removalIdxs.unshift(urlIdx):removalIdxs=[urlIdx+1,urlIdx],{url:o[isLast?urlIdx:urlIdx+1].url}):{url:o[0].url}}(),chrome.tabs.update(next,function(){return removalIdxs.forEach(function(idx){return o.splice(idx,1)}),f.setStorage({page:o},function(){}),f.setBadge(o.length)})):void 0}(respons.page)})})}})}).call(this);